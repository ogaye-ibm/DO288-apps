hello
source-build
omar-gaye-ibm-source-build
greet
https://console-openshift-console.apps.na45.prod.nextcle.com
https://github.com/ogaye-ibm/DO288-apps/nodejs-helloworld
https:/nexus-common.apps.na45.prod.nextcle.com

npm_config_registry

python -m json.tool

oc new-app --as-deployment-config --name greet --strategy source  \
--code https://github.com/ogaye-ibm/DO288-apps#source-build --context-dir nodejs-helloworld 

# Use the httpd-parent image as base
FROM quay.io/redhattraining/httpd-parent

EXPOSE 8080
LABEL io.openshift.expose-services="8080:http" \
io.k8s.display-name="Apache HTTP Server" \
io.openshift.tags="apache, httpd" \
io.k8s.description="A basic Apache HTTP Server child image, use ONBUILD"

RUN sed -i "s/Listen 80/Listen 8080/g" /etc/httpd/conf/httpd.conf

RUN chgrp -R 0 /var/log/httpd /var/run/httpd && \
    chmod -R g=u /var/log/httpd /var/run/httpd

USER 1001

oc login -u omar-gaye-ibm -p e1f59fb10ee34d279c71 https://api.na45.prod.nextcle.com:6443

oc new-app --as-deployment-config --name greet --strategy source  \
--code https://github.com/ogaye-ibm/DO288-apps#source-build --context-dir nodejs-helloworld 

podman login -u ogaye quay.io

oc create secret generic quayio --from-file .dockerconfigjson=${XDG_RUNTIME_DIR}/containers/auth.json --type kubernetes.io/dockerconfigjson

oc secret link default quayio --for pull

oc new-app --as-deployment-config --name sleep --docker-image quay.io/ogaye/ubi-sleep:1.0

skopeo copy --dest-creds=$(oc whoami):$(oc whoami -t) oci:/home/student/DO288/labs/expose-registry/ubi-info docker://${INTERNAL_REGISTRY}/omar-gaye-ibm-common/ubi-info:1.0


skopeo copy oci:/home/student/DO288/labs/expose-image/php-info docker://quay.io/ogaye/php-info
oc import-image php-info --confirm --reference-policy local --from quay.io/ogaye/php-info
oc get istag

oc create secret generic quay-registry
 --from-file .dockerconfigjson=${XDG_RUNTIME_DIR}/containers/auth.json 
 --type kubernetes.io/dockerconfigjson


oc policy add-role-to-group \
 -n omar-gaye-ibm-common system:image-puller \
 system:serviceaccounts:omar-gaye-ibm-expose-image

#!/bin/bash

source /usr/local/etc/ocp4.config
oc set build-hook bc/hook --post-commit --command -- \
    bash -c "\"curl -s -S -i -X POST http://builds-for-managers-${RHT_OCP4_DEV_USER}-post-commit.${RHT_OCP4_WILDCARD_DOMAIN}/api/builds -f -d 'developer=\${DEVELOPER}&git=\${OPENSHIFT_BUILD_SOURCE}&project=\${OPENSHIFT_BUILD_NAMESPACE}'\""


[student@workstation ~]$ cat /usr/local/etc/ocp4.config 
RHT_OCP4_MASTER_API=https://api.na45.prod.nextcle.com:6443
RHT_OCP4_WILDCARD_DOMAIN=apps.na45.prod.nextcle.com
RHT_OCP4_NEXUS_SERVER=nexus-common.apps.na45.prod.nextcle.com
RHT_OCP4_DEV_USER=omar-gaye-ibm
RHT_OCP4_DEV_PASSWORD=e1f59fb10ee34d279c71
RHT_OCP4_GITHUB_USER=ogaye-ibm
RHT_OCP4_QUAY_USER=ogaye

[student@workstation ~]$ oc get route/jenkins -o jsonpath='{.spec.host}{"\n"}' -n omar-gaye-ibm-ci-cd

CICD REVIEW
vi ~/DO288/labs/review-cicd/movies-bc.json

oc new-project omar-gaye-ibm-jenkins
oc new-project omar-gaye-ibm-movies-dev
oc new-project omar-gaye-ibm-movies-stage

oc new-app --as-deployment-config jenkins-ephemeral -p MEMORY_LIMIT=2048Mi

https://github.com/openshift/pipelines-tutorial/

oc new-app  --as-deployment-config --name todoapp \
    --build-env npm_config_registry=\
http://${RHT_OCP4_NEXUS_SERVER}/repository/nodejs \
    -e DATABASE_NAME=todo \
    -e DATABASE_SVC=tododb \
    -e DATABASE_USER=todoapp \
    -e DATABASE_PASSWORD=redhat123 \
    -e DATABASE_INIT=false \
    --context-dir todo-single \
    nodejs:12~https://github.com/${RHT_OCP4_GITHUB_USER}/DO288-apps

oc rsh pod-name env | grep DATABASE
 oc create svc externalname tododb --external-name mysql.ocp-na45.prod.nextcle.com

mvn clean
mvn fabric8:resource
mvn fabric8:deploy

mysqlshow -hmysql.ocp-na45.prod.nextcle.com -utodoapp -predhat123

oc create svc externalname tododb \
 --external-name mysql.ocp-na45.prod.nextcle.com







